# Memory Log - 2026-02-14

### [00:05] Learnings
**Learning (Technical):** When implementing FTS5 triggers for SQLite, triggers cannot call Python code. The text column must be populated separately via Python after insert/reindex. Solution: call rebuild_fts() after reindex() at startup to populate semantic text.

### [00:05] Learnings
**Learning (Technical):** sqlite-vec vec0 tables use KNN query pattern: WHERE embedding MATCH ? AND k = ? for O(log n) performance. Do not use brute force vec_distance_cosine() which is O(n).

### [00:05] Learnings
**Learning (Technical):** Threading.Lock in Python is in-process only - does not protect against multi-process race conditions. For cross-process safety, use SQLite transactions with BEGIN IMMEDIATE, or external locking (portalocker library on Windows).

### [00:05] Learnings
**Learning (Process):** When documenting limitations, include: Symptoms (how it fails), When it triggers (specific conditions), Severity, Detection method, Mitigations ranked by effort/safety, and explicit Non-goals. This makes the doc actionable rather than placeholder-y.

### [00:05] Task Completed
**Task:** Implement Phase 1B semantic search with FTS5 and graceful degradation
**Outcome:** Complete. FTS5 full-text search working with BM25 scoring. vec0 KNN pattern ready for sqlite-vec. Hybrid search degrades gracefully to FTS-only mode. 172 artifacts indexed with semantic text.

### [00:05] Task Completed
**Task:** Upgrade health check with FTS completeness and embedding coverage metrics
**Outcome:** Complete. Health check now reports: fts_text_missing_count, coverage_pct, vec_table_exists, embeddings_count vs artifacts_count, first_broken_entry for audit chain. Overall status correctly promotes errors.

### [00:05] Task Completed
**Task:** Create migration system with schema_migrations tracking
**Outcome:** Complete. migrations/runner.py with checksum verification, m001_add_vectors.py for FTS5+vec0 tables. Migrations are idempotent and tracked.

### [00:06] Task Completed
**Task:** Document multi-process audit chain limitation
**Outcome:** Complete. KNOWN_LIMITATIONS.md created with proper structure: symptoms, triggers, severity, detection, mitigations ranked by effort/safety, and explicit non-goals.

### [00:06] Task Completed
**Task:** Write Phase 1B integration tests
**Outcome:** Complete. tests/test_phase1b_integration.py with golden-path (store->FTS populated) and failure-path (FTS fail->save succeeds) tests. All 8 tests pass.

### [00:45] Learnings
**Learning (Technical):** When implementing temporal queries with text-based ISO timestamp comparisons in SQLite, always normalize input timestamps to a consistent format (Z-suffix) before comparison. Mixed formats (+00:00 vs Z) can cause subtle comparison bugs even though they represent the same time.

### [00:45] Learnings
**Learning (Technical):** For conditional expensive operations (like FTS rebuild), check if the work is actually needed before doing it. In reindex(), checking missing_text_count > 0 before calling rebuild_fts() avoids O(n) overhead when FTS is already complete.

### [00:45] Learnings
**Learning (Process):** When consolidating duplicate code into a shared utility (like time_utils.py), the migration path is: 1) Create utility, 2) Update imports across files, 3) Fix any semantic bugs discovered during consolidation (like timezone mismatch in ranking_config.py).

### [00:45] Task Completed
**Task:** Cleanup sprint: Centralized datetime utils, fixed timezone mismatch, consolidated migration tables, made FTS rebuild conditional
**Outcome:** Created time_utils.py with utc_now(), utc_now_iso(), parse_iso_datetime(), days_since(), normalize_iso_z(). Updated 8 files. Fixed ranking_config.py aware vs naive datetime bug. Migration tracking now single table (schema_migrations).

### [00:45] Task Completed
**Task:** Phase 2: Temporal fields and fact supersession
**Outcome:** Added valid_from, valid_until, superseded_by, importance, pinned to fact schema. Created m002_add_temporal migration. Implemented supersede_fact(), add_relation(), get_relations(), query_current_facts(). Added MCP tools duro_supersede_fact and duro_get_related. All tests pass.
