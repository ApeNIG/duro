# Summary: 2026-02-10

## Learnings
- Claude Code MCP servers must be added to the global `mcpServers` object in `~/.claude.json`, NOT in `~/.claude/settings.json`. The CLI command `claude mcp add` adds to the correct location.
- Successful Notion templates in 2026 prioritize: adaptability (users can customize), automation (pre-built formulas), visual clarity (works on mobile), and community support. Anti-complexity sells - templates that actually stick beat beautiful ones that get abandoned.
- Dual-store pattern for AI memory: Use JSON files as canonical source (human-readable, git-friendly, portable) and SQLite as query index (fast filtering, aggregation). Validate schema at write-time, compute hash for integrity. Artifact envelope wraps all types with consistent metadata (id, type, version, created_at, sensitivity, tags, source, data).
- Duro MCP server exposes 20+ tools across 5 categories: memory, artifacts, skills, rules, and projects. All tools follow consistent patterns with structured JSON responses.
- Reliability layer for agent memory requires: (1) schema validation at write-time with auto-downgrade for violations, (2) operational metadata on skills for pre-execution checks, (3) structured enforcement rules that output allow/deny/constraints decisions, (4) compound skills that chain verification before storage.
- Deletion audit logs are stored as raw JSONL in memory/logs/deletions.jsonl, NOT as artifacts. This is intentional - audit logs shouldn't be deletable artifacts themselves (would create circular dependency). Logs capture: timestamp, artifact_id, type, sensitivity, file_hash, reason, force_used. Written BEFORE deletion so record exists even if delete fails.
- Append-only JSONL audit logs can be made tamper-evident with a simple integrity chain: each entry stores prev_hash (hash of previous line) and entry_hash (hash of current entry). First entry uses "genesis" as prev_hash. Chain verification reads sequentially and compares expected vs actual prev_hash. Broken chain indicates tampering or corruption.
- Audit log repairs must be auditable themselves - always create a meta-audit record (audit_repairs.jsonl) with backup hash, repaired hash, timestamp, and script version. This prevents "we rewrote history" ambiguity.
- Windows terminals using CP1252 encoding crash on emoji characters. Use sys.stdout.reconfigure(encoding='utf-8', errors='replace') at script start, or avoid emojis entirely in CLI output.
- Orchestration pattern: thin routing layer (intent → rules → skill → log) is better than fat orchestrator with embedded logic. One new concept (a "run") ties everything together. Deterministic routing tables beat clever LLM planners for debuggability.

## Tasks Completed
- Build Duro MCP Server: Successfully built and deployed. Server exposes 14 tools for memory, skills, rules, and projects. Connected to Claude Code globally.
- Build dual-store memory system for Duro with artifact envelope pattern: Successfully created: schemas.py (validation), index.py (SQLite layer), artifacts.py (ArtifactStore class). Added 6 new MCP tools (duro_store_fact, duro_store_decision, duro_query_memory, duro_get_artifact, duro_list_artifacts, duro_reindex). Architecture: JSON files canonical, SQLite as query index, schema validation at write-time. Ready for use after MCP server restart.
- Test Duro artifact tools: Successfully tested duro_store_fact, duro_store_decision, duro_list_artifacts, duro_query_memory, duro_get_artifact. Created 2 test artifacts.
- Implement three reliability layer improvements for Duro: Completed all three: (A) verify_and_store_fact skill with truth hygiene workflow, (B) fact_verification hard rule requiring sources for high-confidence facts, (C) skill metadata extended with operational fields (requires_network, timeout_seconds, dependencies, side_effects, fallback_workflow, pre_checks). Updated schemas.py, artifacts.py, duro_mcp_server.py, rules/index.json, skills/index.json.
- Test duro_delete_artifact function: All tests passed: normal delete, verify removal, nonexistent artifact handling, sensitive artifact protection, force delete. Audit logs confirmed working - stored in memory/logs/deletions.jsonl as append-only JSONL (intentionally outside artifact system to prevent circular deletion).
- Implement audit log improvements: integrity chain + query tool: Added two improvements: (1) Integrity chain - each deletion entry now includes prev_hash (hash of previous line, or "genesis" for first) and entry_hash for tamper-evidence. (2) New duro_query_audit_log tool - queries deletions.jsonl with filters (event_type, artifact_id, search_text, since, limit) and optional verify_chain to validate integrity chain. Requires MCP restart to activate.
- Repair broken audit chain integrity in Duro MCP server: Successfully migrated 6 entries to chain_version 1 with proper SHA-256 hashing and prev_hash linkage. Created backup, meta-audit record, and frozen migration script. Chain now validates completely.
- Implement Duro Orchestration Phase 1: Created orchestrator.py with: normalize_intent(), apply_rules(), select_plan(), execute_plan(), write_run_log(). Added MCP tools: duro_orchestrate, duro_list_runs, duro_get_run. Routing table for store_fact, store_decision, delete_artifact. Run logs saved to ~/.agent/memory/runs/. Includes dry_run, sensitivity detection, rule-based constraints.
- Test Duro orchestration loop: Success - verified intent routing, rule checking, tool/skill selection, execution, and run logging all working correctly
- Fix verify_and_store_fact timeout issue: Added 30s timeout handling with graceful degradation. Skill now completes in 41ms instead of timing out at 5 minutes. Pushed to GitHub.
- Fix property scraper missing Manchester areas: Found wrong Rightmove region IDs for Moston (17641), Newton Heath (18316), Miles Platting (17252). Fixed and pushed to GitHub.
- Research synthesis for The Fashanus: Created comprehensive RESEARCH_SYNTHESIS.md with insights from boarding school syndrome, family systems theory, parentification, mixed-race identity development, and Nigerian diaspora dynamics. Includes specific character improvements and 5 research-driven conflict storylines.
- Revise The Fashanus character bible with research insights: Rewrote CHARACTER_BIBLE.md with: show thesis, unspoken family agreement, research-based behavioral patterns for each character, specific triggers/wounds, "The Unsaid" for each character, family triangle dynamics, rooms as emotional spaces, episode design principles.

## Failures & Lessons
- Run generate_tts skill via duro_run_skill: Check that skill dependencies (edge-tts) are installed and network is available before running TTS skills. Consider adding timeout parameter to skill runner.

## Stats
- Original size: 20803 chars
- Total learnings: 12
- Tasks completed: 13
- Failures logged: 1