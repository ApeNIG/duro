# Summary: 2026-02-11

## Learnings
- Run edge-tts directly via 'python -m edge_tts' instead of through Duro skill orchestration. Direct execution completes in seconds; orchestrated skill times out. Apply the simplest tool for the job.
- Illustration style with Pollinations API works well for The Fashanus. No face distortion issues. Prompt pattern: Start with 'Digital illustration, [mood] style, cinematic:' then describe scene. Use seed=42 for consistency. If 404 error, simplify prompt (likely too long).
- CRM Development Workflow: Plan → Build → Review + Security Harden → Test → Commit. Always review code after initial build for: 1) Missing auth/admin checks on APIs, 2) Input validation gaps, 3) XSS in user-controlled content, 4) Graceful handling of missing env vars, 5) Error message consistency. This second pass catches security issues before they compound.
- Development workflow best practices for building apps/software/automations: 1) Plan first - create roadmap and break into phases, 2) Review and improve plan before building - don't settle for average, 3) Build incrementally with tests, 4) Review + security harden after building, 5) Test everything before committing, 6) Document decisions and progress, 7) Log failures and learnings for future reference
- In this CRM codebase: auth uses `getCurrentUser()` not `requireAuth()`. Always check lib/auth.ts exports before assuming function names.
- Next.js 16+ requires Suspense boundaries around components using `useSearchParams()`. Build will fail during static generation otherwise.
- Recharts tooltip/label formatters receive `value` and `name` as potentially undefined. Always use `Number(value) || 0` and `String(label)` for type safety.
- Always read the Prisma schema before writing queries. Field names like `workingHours` (JSON) vs `workingHoursStart` (separate fields) cause build failures. Use `findFirst` not `findUnique` when adding extra WHERE filters.
- When building multi-phase features, understanding earlier patterns compounds. Auth patterns, activity logging, and validation schemas become reusable templates for new features.
- When producing market analysis or strategic documents, actively check for these BS patterns:

## Tasks Completed
- Write and produce Episode 1C: The Confrontation: Created research-grounded script showing all family wounds colliding. Generated 12 audio files via edge-tts directly (lesson applied: no orchestration overhead). Committed to GitHub.
- CRM Phase 1: Schema & Infrastructure + Security Hardening: Built complete Phase 1 foundation for Lore CRM. Added 5 new database models (Settings, EmailTemplate, EmailLog, WebhookEvent, BlackoutDate), enhanced 3 existing models with intelligence fields, created email/inngest/ratelimit libs, Settings and EmailTemplate APIs. Security review added: admin-only API protection, XSS prevention in template interpolation, email validation, graceful handling of missing env vars. 1032 tests passing. Pushed to GitHub.
- Phase 2: Email System for Lore CRM: Completed. Added Resend webhook handler, send email API with rate limiting, send email UI from contact/booking pages, email logs API and display. 13 new files, 1502 lines. All 1032 tests pass.
- Phase 3: Automation Engine for Lore CRM: Completed. Inngest job queue with enquiry auto-response, 24h follow-up, booking confirmation/reminders/thank you/review request workflows. Event triggers integrated into APIs. 9 files, 592 lines. All 1032 tests pass.
- Phase 5: Public Forms & Portal - Complete implementation: Successfully built: 1) Public Enquiry Form with honeypot spam prevention, 2) Public Booking Page with multi-step wizard and time slot selection, 3) Client Portal with magic link authentication. All 1032 tests passing. Security review completed - all best practices in place.
- Reports & Analytics Feature Implementation: Successfully built comprehensive reports feature with: 1) Reports API endpoint with revenue, bookings, leads, and invoice analytics 2) Interactive charts using recharts (RevenueChart, BookingCharts, LeadCharts, InvoiceCharts) 3) DateRangePicker with presets 4) Tabs component for organizing report sections 5) Reports page at /reports with key metrics and detailed breakdowns. All 1032 tests passing.
- Enable hookify plugin and create governance gate rules at host level: Created two hookify rules (governance-gate.local.md for file events, governance-bash.local.md for bash events) and enabled hookify plugin in settings.json. Gate will activate after Claude Code restart. Test showed plugin wasn't active mid-session - rules take effect on next session start.
- Test hookify governance tripwire for .devkit-waiver.yml: Both Write and Bash gates successfully blocked operations. Hook enforcement is real, not cosmetic.
- Fix emoji encoding in hookify governance rules: Replaced emojis with ASCII markers in governance-gate.local.md and governance-bash.local.md
- Add debug logging to hookify pretooluse.py: Added HOOKIFY_DEBUG env var support with timestamped stderr logging for tool, file, rules loaded, and result
- Initialize git repo for .claude config and push to GitHub: Created repo at C:\Users\sibag\.claude with .gitignore, hookify rules, and settings. Pushed to private repo: https://github.com/ApeNIG/claude-config
- Implement S1, S6, S7 safety invariants as hookify rules: Created 3 new hookify rules: credentials-gate (blocks .env, secrets, keys), destructive-bash-gate (blocks rm -rf, curl|sh), git-force-gate (blocks force push to protected branches). All tested and working. 4/8 invariants now enforced at host level.
- Implement S3 network exfiltration gate: Created hookify rule blocking curl/wget POST/PUT, netcat reverse shells, Python/PowerShell outbound POST. GET requests and package managers still work. Tested and verified.
- Implement threat model and 5/8 safety invariants: Created threat model v1.1 with asset-first structure, 7 threats, 5 attacker models. Implemented S1 (credentials), S3 (network exfil), S5 (governance), S6 (destructive bash), S7 (git force) as hookify rules. All tested and working. Remaining: S2 (sink scrubbing), S4 (prod break-glass), S8 (telemetry).
- Implement S4 production gate and S8 telemetry: Created prod-gate rule blocking database CLI, kubectl, AWS, terraform, docker push, npm publish to production. Fixed false positive from overly broad regex. S8 telemetry logs all tool executions to .claude/telemetry/*.jsonl. 7/8 invariants now enforced.

## Failures & Lessons
- Generate Episode 1D images: Check existing rules and documentation FIRST before researching. If we've already solved a problem, use that solution. Don't re-explore paths we've already ruled out. When the user asks "what did we learn last time?" and the answer is clear, apply it directly instead of proposing alternatives.
- UI/UX Redesign visual verification: For ANY UI/UX work: 1) Use pencil.dev get_style_guide for inspiration BEFORE coding, 2) Create mockups with batch_design, 3) After implementation, use get_screenshot to verify components, 4) Compare visual output to design intent. A build passing means nothing for visual correctness.

## Stats
- Original size: 50933 chars
- Total learnings: 56
- Tasks completed: 35
- Failures logged: 2