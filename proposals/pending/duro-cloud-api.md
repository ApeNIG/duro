# Plan Generated by Planify (Claude Code Integration)

**Generated**: 2026-02-14T04:45:15.443104
**Cost**: $0.00 (using Claude Code as LLM)

---

# Duro Cloud - Self-Hosted API Plan

**Generated:** 2026-02-14
**Status:** Approved
**Goal:** Access Duro memory system from anywhere (mobile/web)

---

## Architecture

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│  Mobile/Web     │────▶│  Duro Cloud API  │────▶│  Claude API     │
│  Client         │◀────│  (Render/VPS)    │◀────│  (Anthropic)    │
└─────────────────┘     └────────┬─────────┘     └─────────────────┘
                                 │
                        ┌────────▼─────────┐
                        │  Cloud Database  │
                        │  (Supabase)      │
                        └──────────────────┘
```

---

## Tech Stack

| Layer | Technology |
|-------|------------|
| Runtime | Python 3.11 + FastAPI |
| Database | Supabase (PostgreSQL + pgvector) |
| Auth | API key (phase 1), OAuth (phase 2) |
| Hosting | Render (web service) |
| Client | PWA (mobile + desktop) |

---

## Data Model

Migrate from local SQLite to Supabase PostgreSQL:

| Table | Fields |
|-------|--------|
| `artifacts` | id, type, version, created_at, updated_at, sensitivity, tags[], data (JSONB) |
| `embeddings` | artifact_id, embedding (vector), model |
| `audit_log` | id, event_type, artifact_id, reason, timestamp, chain_hash |
| `sessions` | id, user_id, started_at, last_active |

---

## API Endpoints

| Method | Path | Description |
|--------|------|-------------|
| POST | `/auth/login` | API key authentication |
| POST | `/chat` | Send message, get Claude response |
| GET | `/memory/search` | Semantic search artifacts |
| GET | `/memory/artifacts` | List recent artifacts |
| POST | `/memory/facts` | Store new fact |
| POST | `/memory/decisions` | Store new decision |
| GET | `/context/load` | Load lean/full context |
| WS | `/chat/stream` | Streaming chat responses |

---

## Risks Table

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Anthropic API costs exceed budget | Medium | High | Hard daily limit ($5/day), alerts at 80% |
| Supabase outage | Low | High | Local SQLite fallback, sync when back |
| Auth bypass vulnerability | Low | Critical | Security audit, rate limiting, IP allowlist option |
| Memory data loss | Low | Critical | Daily backups to GitHub private repo |

---

## Implementation Phases

### Phase 1: Foundation (MVP)

| Step | File(s) | Description |
|------|---------|-------------|
| 1 | `duro-cloud/` | Initialize project structure |
| 2 | `duro-cloud/api/main.py` | FastAPI app skeleton |
| 3 | `duro-cloud/api/auth.py` | API key middleware |
| 4 | `duro-cloud/api/chat.py` | Chat endpoint with Claude |
| 5 | `duro-cloud/db/supabase.py` | Supabase client setup |
| 6 | `duro-cloud/db/migrations/` | Schema migrations |
| 7 | `duro-cloud/memory/` | Port Duro memory tools |
| 8 | `render.yaml` | Deployment config |

### Phase 2: Full Memory

| Step | Description |
|------|-------------|
| 9 | Port remaining Duro tools (decisions, episodes, search) |
| 10 | Add semantic search with pgvector |
| 11 | Build sync script (local → cloud) |
| 12 | Add cost tracking + alerts |

### Phase 3: Polish

| Step | Description |
|------|-------------|
| 13 | Build PWA chat interface |
| 14 | Add offline queue + service worker |
| 15 | Implement rate limiting |
| 16 | Security hardening |

---

## Acceptance Criteria

- [ ] Can authenticate with API key
- [ ] Can send chat message and receive Claude response
- [ ] Memory persists in Supabase
- [ ] Can search memories semantically
- [ ] Works from mobile browser
- [ ] Sub-2s response time for simple queries

---

## Validation Steps

1. **Auth:** Invalid key returns 401
2. **Chat:** Message round-trip < 3s
3. **Memory:** Stored fact appears in search
4. **Mobile:** Works on iOS Safari + Android Chrome
5. **Cost:** Daily spend visible in dashboard

---

## Mitigations Summary

| Concern | Mitigation |
|---------|------------|
| Offline handling | PWA with service worker, queue messages locally |
| Rate limiting | 60 req/min per API key |
| Cost tracking | Log tokens per request, daily spend alerts |
| Sync conflicts | Last-write-wins with conflict log for review |
| API key security | HTTPS enforced, keys hashed in DB |
| Cold starts | Render paid tier OR use Cloudflare Workers |
| Storage limits | Compress old artifacts, archive to S3 |


---

_Generated by Planify via SuperAGI MCP | Zero external API cost_
