# Rules Audit - 2026-02-15

**Audit Method:** Bouncer, not librarian.
**Question for each rule:** Can I block/measure this at a chokepoint RIGHT NOW?

---

## Summary

| Verdict | Count | Action |
|---------|-------|--------|
| ENFORCE-NOW + MEASURABLE | 6 | Wire to PreToolUse immediately |
| ENFORCE-NOW + NOT-MEASURABLE | 2 | Keep as soft guardrails |
| ENFORCE-LATER + MEASURABLE | 5 | Roadmap (needs new chokepoints) |
| FLUFF | 44 | Demote to candidates/ or delete |

---

## GOLD RULES (ENFORCE-NOW + MEASURABLE)

These can be wired to PreToolUse hooks TODAY with regex patterns.

### 1. No Destructive Commands (rule_safety_002)
- **File:** safety/no_destructive_commands.json
- **Trigger:** Bash command matches destructive patterns
- **Constraint:** BLOCK
- **Enforcement:** PreToolUse hook on Bash tool
- **Patterns needed:**
  ```regex
  rm\s+(-[rf]+\s+)*[\/\\]       # rm -rf /
  del\s+/[sq]                    # del /s /q (Windows)
  rd\s+/s                        # rd /s (Windows)
  git\s+push\s+.*--force         # force push
  git\s+push\s+.*-f              # force push shorthand
  DROP\s+TABLE                   # SQL drop
  DROP\s+DATABASE                # SQL drop
  TRUNCATE\s+TABLE               # SQL truncate
  ```
- **Eval:** `try rm -rf /tmp/test → expect blocked`
- **Verdict:** ENFORCE-NOW + MEASURABLE
- **Status:** ALREADY WORKING (hook blocked rm -rf in this session)

### 2. No Secrets in Commits (rule_safety_001)
- **File:** safety/no_secrets_commit.json
- **Trigger:** git add/commit with files matching secret patterns
- **Constraint:** BLOCK or WARN
- **Enforcement:** PreToolUse hook on Bash (git add/commit)
- **Patterns needed:**
  ```regex
  \.env$                         # .env files
  credentials\.json$             # credential files
  *_key\.pem$                    # key files
  .*secret.*                     # files with "secret" in name
  (api[_-]?key|password|token)\s*[:=]  # inline secrets
  ```
- **Eval:** `try git add .env → expect blocked`
- **Verdict:** ENFORCE-NOW + MEASURABLE
- **Action:** Add patterns, wire to hook

### 3. Force Push Protection (subset of rule_tool_005)
- **File:** tools/git_operations.json
- **Trigger:** `git push --force` or `git push -f`
- **Constraint:** BLOCK without explicit confirmation
- **Enforcement:** PreToolUse hook on Bash
- **Patterns needed:**
  ```regex
  git\s+push\s+.*(-f|--force)
  ```
- **Eval:** `try git push --force → expect blocked`
- **Verdict:** ENFORCE-NOW + MEASURABLE
- **Action:** Extract to dedicated rule, wire to hook

### 4. Read Before Edit Gate (rule_workflow_001)
- **File:** workflows/read_before_edit.json
- **Trigger:** Edit tool call without prior Read of same file
- **Constraint:** BLOCK or WARN
- **Enforcement:** PreToolUse hook on Edit tool - check session context for Read
- **Implementation:** Track file hashes of Read calls in session, require match before Edit
- **Eval:** `try Edit without Read → expect blocked`
- **Verdict:** ENFORCE-NOW + MEASURABLE
- **Action:** Implement context tracking in hook

### 5. Amend Protection (subset of rule_tool_005)
- **File:** tools/git_operations.json
- **Trigger:** `git commit --amend` when HEAD is already pushed
- **Constraint:** BLOCK
- **Enforcement:** PreToolUse hook on Bash - check git status
- **Patterns needed:**
  ```regex
  git\s+commit\s+.*--amend
  ```
- **Eval:** `push commit, try amend → expect blocked`
- **Verdict:** ENFORCE-NOW + MEASURABLE
- **Action:** Extract to dedicated rule, requires git status check

### 6. Path Sandbox (new rule needed)
- **File:** safety/path_sandbox.json (TO CREATE)
- **Trigger:** Commands operating outside allowed directories
- **Constraint:** BLOCK
- **Enforcement:** PreToolUse hook on Bash
- **Patterns needed:**
  ```regex
  (rm|del|rd)\s+.*[\/\\](Windows|Users|home|etc|var|System32)
  ```
- **Eval:** `try rm /etc/passwd → expect blocked`
- **Verdict:** ENFORCE-NOW + MEASURABLE
- **Action:** Create rule, wire to hook

---

## SOFT GUARDRAILS (ENFORCE-NOW + NOT-MEASURABLE)

Can enforce, but pass/fail is subjective.

### 7. Commit Message Quality (rule_quality_002)
- **File:** quality/commit_messages.json
- **Trigger:** git commit -m "..."
- **Constraint:** WARN if message too short or no type prefix
- **Enforcement:** PreToolUse hook on Bash
- **Why not measurable:** "Good" message is subjective
- **Action:** Keep as soft warning, don't block

### 8. Code Formatting Standards (rule_quality_001)
- **File:** quality/code_formatting.json
- **Trigger:** Write/Edit tool calls
- **Constraint:** WARN if obvious formatting issues
- **Enforcement:** Possible but complex (need linter integration)
- **Why not measurable:** Many valid formatting styles
- **Action:** Keep as guidance only

---

## ROADMAP (ENFORCE-LATER + MEASURABLE)

Need new infrastructure/chokepoints.

### 9. Production Environment Safeguards (rule_safety_003)
- **File:** safety/production_safeguards.json
- **Trigger:** Commands targeting production environment
- **Constraint:** BLOCK without explicit confirmation
- **Needs:** Environment detection, deployment context
- **Verdict:** ENFORCE-LATER
- **Action:** Keep, implement when Render/deploy integration matures

### 10. Input Validation (rule_safety_004)
- **File:** safety/input_validation.json
- **Trigger:** Code that handles user input unsafely
- **Constraint:** WARN
- **Needs:** Static analysis integration (semgrep/codeQL)
- **Verdict:** ENFORCE-LATER
- **Action:** Keep, implement with code analysis tools

### 11. API Rate Limit (rule_failure_008)
- **File:** failures/api_rate_limit.json
- **Trigger:** 429 response from API
- **Constraint:** Backoff, then retry
- **Needs:** Skill runner integration
- **Verdict:** ENFORCE-LATER
- **Action:** Keep, wire to skill_runner

### 12. Network Timeout Handling (rule_failure_001)
- **File:** failures/network_timeout.json
- **Trigger:** Timeout errors from network calls
- **Constraint:** Retry with backoff
- **Needs:** Skill runner integration
- **Verdict:** ENFORCE-LATER
- **Action:** Keep, wire to skill_runner

### 13. Sensitive Data Handling (rule_safety_005)
- **File:** safety/sensitive_data_handling.json
- **Trigger:** PII patterns in output/logs
- **Constraint:** Redact
- **Needs:** Output filter integration
- **Verdict:** ENFORCE-LATER
- **Action:** Keep, implement output filtering

---

## FLUFF (DEMOTE OR DELETE)

No clear trigger, no enforcement point, or purely vibes.

### Workflows - Mostly Fluff

| ID | Name | Why Fluff | Action |
|----|------|-----------|--------|
| rule_workflow_002 | Test After Change | "should test" - no enforcement point | DEMOTE |
| rule_workflow_003 | Git Commit Workflow | Guidance only - already in system prompt | DEMOTE |
| rule_workflow_004 | Episode Production Workflow | Process doc, not rule | DEMOTE |
| rule_workflow_005 | Bug Fix Workflow | Vibes ("debug properly") | DELETE |
| rule_workflow_006 | Feature Implementation Workflow | Vibes ("plan first") | DELETE |
| rule_workflow_007 | Pull Request Creation Workflow | Guidance only | DEMOTE |
| rule_workflow_008 | Skill Creation Workflow | Process doc, not rule | DEMOTE |
| rule_workflow_009 | Session Start Workflow | "hello" trigger too vague | DELETE |
| rule_workflow_010 | Session End Workflow | "goodbye" trigger too vague | DELETE |

### Tools - Mostly Guidance, Not Rules

| ID | Name | Why Fluff | Action |
|----|------|-----------|--------|
| rule_tool_001 | Image Generation Tool Selection | Guidance ("use pollinations") | DEMOTE |
| rule_tool_002 | Code Analysis Tool Selection | Guidance | DEMOTE |
| rule_tool_003 | File Operation Tool Selection | Guidance | DEMOTE |
| rule_tool_004 | Web Research Tool Selection | Guidance | DEMOTE |
| rule_tool_006 | Audio Generation Tool Selection | Guidance | DEMOTE |
| rule_tool_007 | Video Composition Guidelines | Guidance | DEMOTE |
| rule_tool_008 | Task Agent Selection | Guidance | DEMOTE |
| rule_tool_009 | MCP Tool Usage | Guidance | DEMOTE |
| rule_tool_010 | Parallel Tool Execution | Guidance | DEMOTE |
| rule_002 | TTS Voice Selection | Guidance | DEMOTE |
| rule_003 | Tool Selection by Task | Meta-guidance | DELETE |

### Failures - Reactive, Not Preventive

| ID | Name | Why Fluff | Action |
|----|------|-----------|--------|
| rule_failure_002 | Missing Dependency | After-the-fact guidance | DEMOTE |
| rule_failure_003 | File Not Found | After-the-fact guidance | DEMOTE |
| rule_failure_004 | Permission Denied | After-the-fact guidance | DEMOTE |
| rule_failure_005 | JSON Parse Error | After-the-fact guidance | DEMOTE |
| rule_failure_006 | Edit Context Mismatch | Could be preventive (see Read Before Edit) | KEEP |
| rule_failure_007 | Infinite Loop Detection | Needs runner integration | DEMOTE |
| rule_failure_009 | Memory/Context Overflow | After-the-fact | DEMOTE |
| rule_failure_010 | Git Merge Conflict | After-the-fact | DEMOTE |
| rule_failure_011 | Test Failure Handling | After-the-fact | DEMOTE |
| rule_failure_012 | Syntax Error in Code | After-the-fact | DEMOTE |
| rule_failure_013 | Wrong Git Branch | After-the-fact | DEMOTE |
| rule_failure_014 | Encoding Error | After-the-fact | DEMOTE |
| rule_failure_015 | Hook Blocked Operation | Meta (about hooks) | DELETE |

### Quality - All Subjective

| ID | Name | Why Fluff | Action |
|----|------|-----------|--------|
| rule_quality_003 | Error Handling Quality | Subjective | DELETE |
| rule_quality_004 | Documentation Quality | Subjective | DELETE |
| rule_quality_005 | Test Coverage Quality | Subjective | DELETE |
| rule_quality_006 | Audio Output Quality | Needs verifier integration | DEMOTE |
| rule_quality_007 | Video Output Quality | Needs verifier integration | DEMOTE |
| rule_quality_008 | API Response Quality | Subjective | DELETE |
| rule_quality_009 | Skill Output Quality | Subjective | DELETE |
| rule_quality_010 | Response Conciseness | Subjective | DELETE |

### Other - Legacy

| ID | Name | Why Fluff | Action |
|----|------|-----------|--------|
| rule_001 | Face Distortion | Specific to image gen - keep as guidance | DEMOTE |
| rule_004 | Stop Conditions | Already in system prompt | DELETE |
| rule_005 | Fact Verification Requirements | Guidance | DEMOTE |
| rule_006 | Layered Governance Constitution | Meta doc, not rule | DEMOTE |
| rule_007 | Mockup Before Design Implementation | Guidance | DEMOTE |

---

## Final Tally

| Category | Keep (Active) | Demote (Candidates) | Delete |
|----------|---------------|---------------------|--------|
| Safety | 5 | 0 | 0 |
| Tools | 1 (git force push) | 9 | 1 |
| Workflows | 1 (read before edit) | 4 | 5 |
| Failures | 2 | 11 | 2 |
| Quality | 0 | 2 | 8 |
| Other | 0 | 5 | 2 |
| **TOTAL** | **9** | **31** | **18** |

---

## Immediate Actions

### 1. Create Gold Rules with Patterns (6 rules)
Wire these to PreToolUse hook with actual regex:

```json
{
  "destructive_commands": {
    "patterns": [
      "rm\\s+(-[rf]+\\s+)*\\/",
      "del\\s+\\/[sq]",
      "rd\\s+\\/s",
      "git\\s+push\\s+.*--force",
      "git\\s+push\\s+.*\\s-f\\b",
      "DROP\\s+(TABLE|DATABASE)",
      "TRUNCATE\\s+TABLE"
    ],
    "action": "block"
  },
  "secrets_in_commit": {
    "file_patterns": ["\\.env$", "credentials\\.json$", ".*secret.*"],
    "content_patterns": ["(api[_-]?key|password|token)\\s*[:=]\\s*['\"][^'\"]+['\"]"],
    "action": "block"
  },
  "read_before_edit": {
    "check": "session_has_read_for_file",
    "action": "block"
  },
  "amend_pushed_commit": {
    "pattern": "git\\s+commit\\s+.*--amend",
    "check": "head_not_pushed",
    "action": "block"
  },
  "path_sandbox": {
    "forbidden_paths": ["/Windows", "/Users", "/home", "/etc", "/var", "/System32"],
    "action": "block"
  }
}
```

### 2. Move 31 Rules to candidates/
Create `rules/candidates/` and move demoted rules.

### 3. Delete 18 Fluff Rules
Pure vibes with no enforcement path.

### 4. Create Enforcement Evals
Add 6 evals that attempt forbidden actions and expect "blocked".

---

## Success Criteria

After this pivot:
- [ ] 6-9 rules with actual enforcement
- [ ] PreToolUse hook blocks forbidden patterns
- [ ] 6 enforcement evals passing
- [ ] Remaining rules clearly labeled as "guidance" not "rules"
