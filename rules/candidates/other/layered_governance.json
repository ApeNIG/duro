{
  "id": "rule_006",
  "name": "Layered Governance Constitution",
  "type": "hard",
  "priority": 1,
  "description": "Enforce separation of concerns: DevKit owns CI enforcement, Duro owns memory, SuperAGI owns execution. No blurring of layers.",

  "triggers": {
    "keywords": [
      "waiver",
      "devkit",
      "auto-generate",
      "policy change",
      "governance",
      "contract version",
      "ci enforcement",
      "exempt",
      "skip check",
      "bypass"
    ],
    "file_patterns": [
      ".devkit-waiver.yml",
      ".devkit-waiver.yaml",
      "devkit.config.json",
      ".devkit/state.json"
    ],
    "behavior_triggers": [
      "Write tool targets .devkit-waiver.yml",
      "Edit tool targets devkit.config.json",
      "Bash writes to governance files",
      "Any silent file write to DevKit config paths"
    ]
  },

  "enforcement": {
    "checks": [
      {
        "id": "no-silent-waivers",
        "condition": "action plan includes writing .devkit-waiver.yml directly",
        "decision": "deny",
        "denied_path": "Write waiver file directly via Write/Edit/Bash",
        "allowed_path": "Open PR with waiver entry via gh pr create",
        "required_fields": ["expiry_date", "justification", "failing_run_url", "approved_by"],
        "next_action_template": {
          "tool": "Bash",
          "command": "gh pr create --title 'chore: Add waiver for {rule_id}' --body \"$(cat <<'EOF'\n## Waiver Request\n\n**Rule:** {rule_id}\n**Reason:** {justification}\n**Expires:** {expiry_date}\n**Failing Run:** {failing_run_url}\n\n---\nGenerated by agent. Requires human approval.\nEOF\n)\""
        }
      },
      {
        "id": "no-silent-config-changes",
        "condition": "action plan includes editing devkit.config.json directly",
        "decision": "deny",
        "denied_path": "Edit devkit.config.json without PR",
        "allowed_path": "Open PR with config change via gh pr create",
        "required_fields": ["change_description", "rationale"]
      },
      {
        "id": "duro-not-source-of-truth",
        "condition": "Duro asserting what contract version is currently enforced",
        "decision": "deny",
        "denied_path": "Duro claims 'we are on contract 1.x'",
        "allowed_path": "Duro says 'as of commit abc123, contract was 1.x'",
        "action": "CI is source of truth. Duro stores historical context only. Always reference specific commit."
      },
      {
        "id": "devkit-facts-only",
        "condition": "DevKit creating tasks or managing work items",
        "decision": "deny",
        "denied_path": "DevKit outputs task assignments, due dates, owners",
        "allowed_path": "DevKit outputs facts; Duro/SuperAGI creates tasks from facts"
      },
      {
        "id": "no-cross-system-sync",
        "condition": "syncing rules across DevKit/Duro/SuperAGI",
        "decision": "deny",
        "denied_path": "Auto-sync Duro rules to devkit.config.json",
        "allowed_path": "Each system owns its own config independently"
      },
      {
        "id": "provenance-required",
        "condition": "storing DevKit results without provenance",
        "decision": "deny",
        "denied_path": "Store 'PR #42 failed typecheck' without coordinates",
        "allowed_path": "Store with repo, branch, SHA, run URL, timestamp",
        "required_fields": ["repo", "branch", "commit_sha", "run_url", "timestamp"]
      }
    ]
  },

  "layer_boundaries": {
    "devkit": {
      "owns": ["repo quality policy", "enforcement", "verdicts", "devkit.config.json", "waivers"],
      "does_not_own": ["tasks", "memory", "agent behavior", "live decisions"],
      "output_type": "facts_only"
    },
    "duro": {
      "owns": ["memory", "decisions", "learnings", "historical context", "agent behavioral rules"],
      "does_not_own": ["repo policy", "CI enforcement", "live contract state"],
      "output_type": "historical_context"
    },
    "superagi": {
      "owns": ["execution capabilities", "running commands"],
      "does_not_own": ["policy", "memory", "decisions"],
      "output_type": "action_execution"
    }
  },

  "golden_rules": [
    "CI is source of truth for what contract is actually enforced",
    "Waivers are code-reviewed artifacts, not silent agent side-effects",
    "DevKit stays dumb and authoritative - facts only, no tasks",
    "If any system starts doing what another owns, that's the hydra forming"
  ],

  "references": {
    "decision_id": "decision_20260211_092101_jn3f9k",
    "approved_by": "user",
    "approved_date": "2026-02-11"
  },

  "maintenance": {
    "on_edit": "Run duro_reindex after any rule file changes",
    "audit_frequency": "Check times_applied weekly to verify rule is firing"
  },

  "known_limitations": {
    "keyword_bypass": {
      "description": "Rule can be bypassed by rephrasing to avoid trigger keywords",
      "examples": ["'exempt lint' avoids 'waiver'", "'skip check' avoids 'governance'"],
      "mitigation": "Git history + CI enforcement at merge time",
      "future_fix": "Behavior-based triggering (check file paths, not just task description)",
      "proposal": ".agent/proposals/pending/2026-02-11_behavior_based_rule_triggering.md"
    }
  },

  "confidence": 1.0,
  "source": "constitutional_decision",
  "last_validated": "2026-02-11",
  "times_applied": 0
}
