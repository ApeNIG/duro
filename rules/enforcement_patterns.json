{
  "version": "1.0",
  "description": "Actual enforcement patterns for PreToolUse hooks",
  "last_updated": "2026-02-15",
  "enforcement_rules": [
    {
      "id": "destructive_bash_commands",
      "name": "Block Destructive Shell Commands",
      "type": "hard",
      "tool": "Bash",
      "action": "block",
      "patterns": [
        {"regex": "rm\\s+(-[rf]+\\s+)*[/\\\\]", "description": "rm -rf with root path"},
        {"regex": "rm\\s+-[rf]*\\s+-[rf]*\\s+", "description": "rm with recursive/force flags"},
        {"regex": "del\\s+/[sq]", "description": "Windows del with /s or /q"},
        {"regex": "rd\\s+/s", "description": "Windows rd /s (recursive)"},
        {"regex": "rmdir\\s+/s", "description": "Windows rmdir /s"},
        {"regex": "git\\s+push\\s+.*--force", "description": "git push --force"},
        {"regex": "git\\s+push\\s+(-f\\b|.*\\s-f\\b)", "description": "git push -f"},
        {"regex": "git\\s+reset\\s+--hard", "description": "git reset --hard"},
        {"regex": "DROP\\s+(TABLE|DATABASE|INDEX)", "description": "SQL DROP statements", "flags": "i"},
        {"regex": "TRUNCATE\\s+TABLE", "description": "SQL TRUNCATE", "flags": "i"},
        {"regex": "format\\s+[a-zA-Z]:", "description": "Windows format drive"},
        {"regex": "mkfs\\.", "description": "Linux format filesystem"}
      ],
      "message": "Destructive command blocked. Use explicit confirmation if intended."
    },
    {
      "id": "secrets_in_git",
      "name": "Block Secrets in Git Operations",
      "type": "hard",
      "tool": "Bash",
      "action": "block",
      "patterns": [
        {"regex": "git\\s+add\\s+.*\\.env\\b", "description": "git add .env file"},
        {"regex": "git\\s+add\\s+.*credentials\\.json", "description": "git add credentials.json"},
        {"regex": "git\\s+add\\s+.*\\.pem\\b", "description": "git add .pem file"},
        {"regex": "git\\s+add\\s+.*secret", "description": "git add file with 'secret' in name", "flags": "i"},
        {"regex": "git\\s+add\\s+.*\\.key\\b", "description": "git add .key file"},
        {"regex": "git\\s+add\\s+.*id_rsa", "description": "git add SSH key"},
        {"regex": "git\\s+add\\s+.*\\.(p12|pfx)\\b", "description": "git add certificate file"}
      ],
      "content_patterns": [
        {"regex": "(api[_-]?key|apikey)\\s*[:=]\\s*['\"][^'\"]{10,}['\"]", "description": "API key assignment", "flags": "i"},
        {"regex": "(password|passwd)\\s*[:=]\\s*['\"][^'\"]+['\"]", "description": "Password assignment", "flags": "i"},
        {"regex": "(secret|token)\\s*[:=]\\s*['\"][^'\"]{10,}['\"]", "description": "Secret/token assignment", "flags": "i"},
        {"regex": "-----BEGIN (RSA |DSA |EC )?PRIVATE KEY-----", "description": "Private key block"},
        {"regex": "sk-[a-zA-Z0-9]{20,}", "description": "OpenAI API key pattern"},
        {"regex": "ghp_[a-zA-Z0-9]{36}", "description": "GitHub personal access token"},
        {"regex": "AKIA[0-9A-Z]{16}", "description": "AWS access key ID"}
      ],
      "message": "Potential secret detected. Remove sensitive data before committing."
    },
    {
      "id": "amend_pushed_commit",
      "name": "Block Amending Pushed Commits",
      "type": "hard",
      "tool": "Bash",
      "action": "warn",
      "patterns": [{"regex": "git\\s+commit\\s+.*--amend", "description": "git commit --amend"}],
      "requires_check": "verify_head_not_pushed",
      "message": "Warning: amending may rewrite pushed history. Verify HEAD is not pushed."
    },
    {
      "id": "path_sandbox",
      "name": "Block Operations Outside Safe Paths",
      "type": "hard",
      "tool": "Bash",
      "action": "block",
      "patterns": [
        {"regex": "(rm|del|rd|rmdir)\\s+.*[/\\\\](Windows|System32)", "description": "Windows system directories", "flags": "i"},
        {"regex": "(rm|del)\\s+.*[/\\\\](etc|var|boot|lib|lib64|sbin|bin)[/\\\\]", "description": "Linux system directories"},
        {"regex": "(rm|del)\\s+.*~[/\\\\]\\.", "description": "Home directory dotfiles (tilde)"},
        {"regex": "(rm|del)\\s+.*\\.(ssh|gnupg|config|local)", "description": "Home dotfiles by name"}
      ],
      "message": "Operation on system path blocked. Specify exact target if intended."
    },
    {
      "id": "read_before_edit",
      "name": "Require Read Before Edit",
      "type": "hard",
      "tool": "Edit",
      "action": "check",
      "requires_check": "session_has_read_for_file",
      "message": "File must be read before editing. Use Read tool first."
    },
    {
      "id": "skip_hooks_protection",
      "name": "Block Skipping Git Hooks",
      "type": "hard",
      "tool": "Bash",
      "action": "block",
      "patterns": [
        {"regex": "git\\s+commit\\s+.*--no-verify", "description": "git commit --no-verify"},
        {"regex": "git\\s+push\\s+.*--no-verify", "description": "git push --no-verify"},
        {"regex": "git\\s+.*--no-gpg-sign", "description": "Skip GPG signing"}
      ],
      "message": "Skipping git hooks is blocked. Remove --no-verify flag."
    }
  ],
  "soft_warnings": [
    {
      "id": "short_commit_message",
      "name": "Warn on Short Commit Messages",
      "type": "soft",
      "tool": "Bash",
      "action": "warn",
      "patterns": [{"regex": "git\\s+commit\\s+-m\\s*['\"][^'\"]{1,10}['\"]", "description": "Commit message under 10 chars"}],
      "message": "Commit message may be too short. Consider adding more context."
    }
  ]
}
